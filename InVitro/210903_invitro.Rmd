---
output:
  html_document: 
    df_print: default
    highlight: haddock
    keep_md: yes
    theme: paper
editor_options: 
  chunk_output_type: console
---
# *in vitro* primary microglia
Data analysis of *in vitro* microglia secretion of IL-6 and TNFa protein into the cell culture supernatant in response to a 12 hour LPS and IFNg treatment. For each independent culture experiment the control was set to one and log normalized.

## Samples
```{r input, echo=FALSE, message=FALSE}
library(readr)
library(tidyverse)
library(ggplot2)
library(cowplot)
library(rstatix)

data <- read_csv("data.csv")
data = data %>% 
  mutate('Log2IL6'=log2(il6)) %>% 
  mutate('Log2TNFa'=log2(tnfa))

data$Age <- relevel(as.factor(data$Age), ref = "E18")
table(data$Group, data$Age, data$Region)
```

```{r plots}
data2 <- pivot_longer(data, cols = starts_with("Log2"), names_to = "cytokine", values_to = "log2FC")

data2 %>% filter(Group=="MIA" & Region=="Ctx") %>% ggplot(., aes(x=Age, y=log2FC, color = cytokine, group = cytokine)) + geom_point(aes(group = cytokine), position = position_jitterdodge(dodge.width=0.7, jitter.width = 0.15), size = 3) + geom_hline(yintercept = 0) + stat_summary(fun.data=mean_se, color="black", shape = 3, size=1, position = position_dodge(width = 0.5)) + ylim(-1.3, 1.3) + labs(y="FC (log2)") + theme(legend.position ="none") + labs(subtitle = "cortex") + theme_cowplot() + scale_color_manual(values = c("red", "red4"))

data2 %>% filter(Group=="MIA" & Region=="Str") %>% ggplot(., aes(x=Age, y=log2FC, color = cytokine, group = cytokine)) + geom_point(aes(group = cytokine), position = position_jitterdodge(dodge.width=0.7, jitter.width = 0.15), size = 3) + geom_hline(yintercept = 0) + stat_summary(fun.data=mean_se, color="black", shape = 3, size=1, position = position_dodge(width = 0.5)) + ylim(-1.3, 1.3) + labs(y="FC (log2)") + theme(legend.position ="none") + labs(subtitle = "striatum") + theme_cowplot() + scale_color_manual(values = c("red", "red4"))

# Effect of Sex

data2 %>% filter(Group=="MIA" & Region=="Ctx") %>% ggplot(., aes(x=Age, y=log2FC, color = Sex, group = cytokine)) + geom_point(aes(group = cytokine), position = position_jitterdodge(dodge.width=0.7, jitter.width = 0.15), size = 3) + geom_hline(yintercept = 0) + stat_summary(fun.data=mean_se, color="black", shape = 3, size=1, position = position_dodge(width = 0.5)) + ylim(-1.3, 1.3) + labs(y="FC (log2)") + theme(legend.position ="none") + labs(subtitle = "Ctx") + theme_cowplot() + scale_color_manual(values = c("deeppink2", "blue"))

data2 %>% filter(Group=="MIA" & Region=="Str") %>% ggplot(., aes(x=Age, y=log2FC, color = Sex, group = cytokine)) + geom_point(aes(group = cytokine), position = position_jitterdodge(dodge.width=0.7, jitter.width = 0.15), size = 3) + geom_hline(yintercept = 0) + stat_summary(fun.data=mean_se, color="black", shape = 3, size=1, position = position_dodge(width = 0.5)) + ylim(-1.3, 1.3) + labs(y="FC (log2)") + theme(legend.position ="none") + labs(subtitle = "Ctx") + theme_cowplot() + scale_color_manual(values = c("deeppink2", "blue"))

```


## Shapiro-Wilk test for normality
```{r, echo=FALSE}
data %>% filter(Group == "MIA") %>% group_by(Age, Region) %>% shapiro_test(Log2IL6)
data %>% filter(Group == "MIA") %>% group_by(Age, Region) %>% shapiro_test(Log2TNFa)
```
***
## Perform one-sample t-test
```{r, echo=FALSE}
message("IL-6")
data %>% filter(Group == "MIA") %>% group_by(Region, Age) %>%  select(Log2IL6) %>% mutate(pval = t.test(Log2IL6, mu=0)$p.value,stat = t.test(Log2IL6, mu=0)$statistic, df = t.test(Log2IL6, mu=0)$parameter)

message("TNFa")
data %>% filter(Group == "MIA") %>% group_by(Region, Age) %>% select(Log2TNFa) %>% mutate(pval = t.test(Log2TNFa, mu=0)$p.value, stat = t.test(Log2TNFa, mu=0)$statistic, df = t.test(Log2TNFa, mu=0)$parameter)
```
### Conclusion: Striatum microglia showed significantly less IL-6 and TNFa secretion at both E18 and Adult. Cortex microglia do not show a change in secretion at E18, and a mild IL-6 reduction in adult. 

### Reproducibility info
```{r, echo=FALSE}
Sys.time()
devtools::session_info()
```